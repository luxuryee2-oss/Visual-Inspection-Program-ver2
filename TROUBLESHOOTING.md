# 저장 문제 해결 가이드

## 저장이 안 될 때 확인 사항

### 1단계: 백엔드 서버 확인

#### 서버가 실행 중인가요?
```bash
cd backend
npm run dev
```

서버가 실행되면 다음과 같은 메시지가 표시됩니다:
```
서버가 포트 3000에서 실행 중입니다.
```

#### Health Check 확인
브라우저나 터미널에서:
```bash
# 브라우저
http://localhost:3000/api/health

# 또는 터미널
curl http://localhost:3000/api/health
```

정상이면 `{"status":"ok"}` 응답이 옵니다.

### 2단계: 프론트엔드에서 서버 연결 확인

#### 브라우저 콘솔 확인
1. 스마트폰 크롬에서 F12 또는 개발자 도구 열기
2. Console 탭 확인
3. Network 탭에서 API 요청 상태 확인

#### API 주소 확인
프론트엔드 코드에서 API 주소가 올바른지 확인:
- 로컬 개발: `http://localhost:3000/api` (같은 컴퓨터에서만 접근 가능)
- 스마트폰 접근: 컴퓨터의 로컬 IP 주소 사용 (예: `http://192.168.0.100:3000/api`)

### 3단계: 백엔드 서버 로그 확인

저장을 시도할 때 **백엔드 서버 콘솔**에 상세한 로그가 출력됩니다:

#### 정상적인 로그 예시:
```
============================================================
📥 새로운 저장 요청 수신
============================================================
요청 데이터: {...}
✅ 유효성 검사 통과
🔄 SharePoint 저장 시작...
🔐 SharePoint 저장 함수 시작
환경 변수 확인: {...}
🔑 Azure 액세스 토큰 가져오는 중...
✅ 액세스 토큰 획득 성공
사이트 ID 자동 조회 중...
...
✅ 저장 완료! (소요 시간: 1234 ms)
============================================================
```

#### 오류가 발생한 경우:
```
============================================================
❌ 저장 오류 발생! (소요 시간: 500 ms)
============================================================
오류 타입: Error
오류 메시지: ...
오류 스택: ...
```

### 4단계: 환경 변수 확인

`backend/.env` 파일에 다음 설정이 올바른지 확인:

```env
# Azure 인증 (필수)
AZURE_CLIENT_ID=...
AZURE_CLIENT_SECRET=...
AZURE_TENANT_ID=...

# SharePoint 설정
SHAREPOINT_SITE_URL=https://kyungshino365.sharepoint.com/sites/checksheet
SHAREPOINT_FOLDER_PATH=InspectionData
SHAREPOINT_LIST_ID=List45
```

### 5단계: 일반적인 오류 및 해결 방법

#### 오류: "서버에 연결할 수 없습니다"
**원인:**
- 백엔드 서버가 실행되지 않음
- API 주소가 잘못됨
- 방화벽 문제

**해결:**
1. 백엔드 서버 실행 확인
2. API 주소 확인 (같은 네트워크의 IP 주소 사용)
3. 방화벽에서 포트 3000 허용

#### 오류: "Azure 인증 설정이 완료되지 않았습니다"
**원인:**
- `.env` 파일이 없거나 환경 변수가 설정되지 않음

**해결:**
1. `backend/.env` 파일 생성
2. 필요한 환경 변수 모두 설정
3. 서버 재시작

#### 오류: "SharePoint 설정이 완료되지 않았습니다"
**원인:**
- SharePoint 사이트 URL이 잘못됨
- Azure 앱 등록 권한 문제

**해결:**
1. `SHAREPOINT_SITE_URL` 확인
2. Azure Portal에서 앱 권한 확인 (`Sites.ReadWrite.All`)
3. 관리자 동의 완료 여부 확인

#### 오류: "리스트 저장 실패"
**원인:**
- 리스트 ID가 잘못됨
- 리스트 컬럼 이름이 맞지 않음
- 권한 문제

**해결:**
1. 디버깅 API로 리스트 정보 확인: `http://localhost:3000/api/inspection/list-info`
2. 리스트 컬럼 이름 확인
3. 코드의 컬럼 매핑 수정

### 6단계: 디버깅 도구 사용

#### 리스트 정보 확인
```
GET http://localhost:3000/api/inspection/list-info
```

이 API는 리스트의 모든 컬럼 정보를 보여줍니다.

#### 상세 로그 확인
저장 시도 시 백엔드 서버 콘솔에서:
- 각 단계의 성공/실패 상태
- 사용 가능한 컬럼 목록
- 시도한 필드 매핑
- 상세 오류 메시지

## 빠른 체크리스트

- [ ] 백엔드 서버가 실행 중인가요?
- [ ] Health check API가 정상 응답하나요?
- [ ] `.env` 파일이 올바르게 설정되어 있나요?
- [ ] 브라우저 콘솔에 오류가 있나요?
- [ ] 백엔드 서버 콘솔 로그를 확인했나요?
- [ ] API 주소가 스마트폰에서 접근 가능한가요?

## 도움 요청 시 포함할 정보

문제를 해결하기 위해 다음 정보를 준비해주세요:

1. **백엔드 서버 콘솔 로그** (전체)
2. **브라우저 콘솔 로그** (전체)
3. **Network 탭의 API 요청/응답**
4. **오류 메시지** (전체)
5. **환경 변수 설정 상태** (민감 정보 제외)




