# 저장 문제 디버깅 가이드

## 저장이 안 되는 경우 확인 사항

### 1단계: 리스트 정보 확인

먼저 리스트의 컬럼 구조를 확인합니다:

```bash
# 브라우저에서 접속
http://localhost:3000/api/inspection/list-info

# 또는 터미널에서
curl http://localhost:3000/api/inspection/list-info
```

이 API는 다음 정보를 반환합니다:
- 리스트 ID
- 사용 가능한 모든 컬럼 목록
- 각 컬럼의 이름, 타입, 필수 여부

### 2단계: 서버 로그 확인

저장을 시도한 후 **백엔드 서버 콘솔**을 확인하세요. 다음 정보가 출력됩니다:

#### 성공적인 로그 예시:
```
리스트 저장 시작...
리스트 컬럼 조회 완료. 컬럼 수: 8
사용 가능한 컬럼 목록: [...]
컬럼 매핑 성공: "제품명" → "제품명"
검사자 필드 매핑 성공: "검사자"
비고 필드 매핑 성공: "비고"
정면 사진 링크 필드 매핑 성공: "정면"
=== 리스트 아이템 추가 시도 ===
추가할 필드: {...}
✅ 리스트 아이템 추가 완료! ID: 123
```

#### 실패 로그 예시:
```
❌ 리스트 아이템 추가 실패 ==========
오류 메시지: Invalid field name
오류 응답 본문: {...}
사용 가능한 컬럼: Title, 제품명, 검사자, ...
```

### 3단계: 확인해야 할 내용

#### A. 리스트 ID 확인
`.env` 파일에 다음 설정이 올바른지 확인:
```env
SHAREPOINT_LIST_ID=List45
```

만약 리스트 ID가 GUID 형식이라면:
```env
SHAREPOINT_LIST_ID={GUID-형식-ID}
```

#### B. 컬럼 이름 확인
서버 로그에서 다음을 확인:
1. **"사용 가능한 컬럼 목록"** - 실제 리스트에 있는 컬럼들
2. **"컬럼 매핑 성공"** 메시지 - 어떤 컬럼이 매핑되었는지
3. **경고 메시지** - 매핑되지 않은 컬럼들

#### C. 오류 메시지 분석
오류 메시지의 의미:
- `Invalid field name` - 컬럼 이름이 잘못되었습니다
- `Required field missing` - 필수 컬럼이 비어있습니다
- `Access denied` - 권한 문제입니다
- `List not found` - 리스트를 찾을 수 없습니다

### 4단계: 일반적인 문제 해결

#### 문제 1: 컬럼 이름이 다름

**증상:**
- 로그에 "컬럼을 찾을 수 없습니다" 경고
- 일부 필드만 저장됨

**해결:**
1. 리스트 정보 API로 실제 컬럼 이름 확인
2. `backend/src/services/sharepoint.ts` 파일의 `findColumn` 함수 호출 부분 수정
   - 예: `['제품명', ...]` → `['실제컬럼이름', ...]`

#### 문제 2: 필수 컬럼이 비어있음

**증상:**
- 오류: "Required field missing"

**해결:**
1. 로그에서 "required: true"인 컬럼 확인
2. 해당 컬럼을 필드에 포함하도록 코드 수정

#### 문제 3: 리스트를 찾을 수 없음

**증상:**
- 오류: "List not found" 또는 "리스트 ID 조회 실패"

**해결:**
1. `.env` 파일의 `SHAREPOINT_LIST_ID` 값 확인
2. 디버깅 API로 실제 리스트 ID 확인
3. 올바른 리스트 ID로 업데이트

#### 문제 4: 권한 문제

**증상:**
- 오류: "Access denied" 또는 403 에러

**해결:**
1. Azure AD 앱 등록 권한 확인
   - `Sites.ReadWrite.All` 권한이 있는지
   - 관리자 동의가 완료되었는지
2. SharePoint 리스트 권한 확인

## 빠른 진단 체크리스트

- [ ] 백엔드 서버가 실행 중인가요?
- [ ] `.env` 파일에 Azure 인증 정보가 올바르게 설정되어 있나요?
- [ ] `.env` 파일에 `SHAREPOINT_LIST_ID`가 설정되어 있나요?
- [ ] 디버깅 API(`/api/inspection/list-info`)가 정상 동작하나요?
- [ ] 서버 콘솔 로그를 확인했나요?
- [ ] 실제 리스트 컬럼 이름과 코드의 컬럼 이름이 일치하나요?

## 도움 요청 시 포함할 정보

문제를 해결하기 위해 다음 정보를 준비해주세요:

1. **디버깅 API 결과**
   ```
   GET http://localhost:3000/api/inspection/list-info
   ```

2. **서버 로그 (저장 시도 시 출력된 모든 로그)**

3. **오류 메시지** (전체)

4. **리스트의 실제 컬럼 이름 목록** (SharePoint에서 확인)

이 정보를 제공해주시면 정확한 원인을 파악하고 해결책을 제시할 수 있습니다.




